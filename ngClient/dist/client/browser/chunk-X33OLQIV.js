import{a as E}from"./chunk-6QSMJCUJ.js";import{a as x,b as c,c as N,d as F,e as T,f as I,g as D,h as w,i as q,j as R,k as A,l as M,m as k}from"./chunk-E7MIS4QH.js";import{a as b}from"./chunk-VHTBEU7Y.js";import{c as S,g as C,n as y}from"./chunk-EQG5L6AV.js";import{$a as l,Ca as _,Ha as p,Oa as s,R as g,Ra as i,Sa as e,Ta as u,Xa as f,Ya as d,bb as h,ta as o}from"./chunk-VEP5YUMW.js";function V(r,a){r&1&&(i(0,"span"),l(1,"Title is required"),e())}function O(r,a){if(r&1&&(i(0,"div",30),p(1,V,2,0,"span",27),e()),r&2){let t=d();o(),s("ngIf",t.title==null||t.title.errors==null?null:t.title.errors.required)}}function P(r,a){r&1&&(i(0,"span"),l(1,"Release type is required"),e())}function j(r,a){if(r&1&&(i(0,"div",30),p(1,P,2,0,"span",27),e()),r&2){let t=d();o(),s("ngIf",t.type==null||t.type.errors==null?null:t.type.errors.required)}}function U(r,a){r&1&&(i(0,"span"),l(1,"Release date is required"),e())}function B(r,a){if(r&1&&(i(0,"div",30),p(1,U,2,0,"span",27),e()),r&2){let t=d();o(),s("ngIf",t.releaseDate==null||t.releaseDate.errors==null?null:t.releaseDate.errors.required)}}function L(r,a){r&1&&(i(0,"span"),l(1,"Version is required"),e())}function Y(r,a){if(r&1&&(i(0,"div",30),p(1,L,2,0,"span",27),e()),r&2){let t=d();o(),s("ngIf",t.version==null||t.version.errors==null?null:t.version.errors.required)}}function z(r,a){r&1&&(i(0,"div",30),l(1," Cover image is required "),e())}function H(r,a){r&1&&(i(0,"span"),l(1,"Creating..."),e())}function J(r,a){r&1&&(i(0,"span"),l(1,"Create Release"),e())}function K(r,a){if(r&1&&(i(0,"div",31),l(1),e()),r&2){let t=d();o(),h(" ",t.errorMessage," ")}}var G=class r{releaseForm;errorMessage=null;isSubmitting=!1;selectedCoverImage=null;selectedAudioFiles=[];fb=g(M);releaseService=g(E);authService=g(b);router=g(y);constructor(){this.releaseForm=this.fb.group({title:["",[c.required,c.minLength(1)]],type:["",[c.required]],description:[""],releaseDate:["",[c.required]],version:["1.0",[c.required]],musicTags:[""]})}ngOnInit(){}get title(){return this.releaseForm.get("title")}get type(){return this.releaseForm.get("type")}get description(){return this.releaseForm.get("description")}get releaseDate(){return this.releaseForm.get("releaseDate")}get version(){return this.releaseForm.get("version")}get musicTags(){return this.releaseForm.get("musicTags")}onFileChange(a){let t=a.target.files[0];t?(this.selectedCoverImage=t,console.log("Cover image selected:",t.name)):(this.selectedCoverImage=null,console.log("No cover image selected"))}onAudioFileChange(a){let t=Array.from(a.target.files);t.length>0?(this.selectedAudioFiles=t,console.log("Audio files selected:",t.map(n=>n.name))):(this.selectedAudioFiles=[],console.log("No audio files selected"))}cancel(){this.router.navigate(["/home"])}onSubmit(){if(this.releaseForm.invalid||!this.selectedCoverImage){this.markFormGroupTouched();return}this.isSubmitting=!0,this.errorMessage=null;let a=this.authService.getCurrentUser();if(!a){this.errorMessage="You must be logged in to create a release",this.isSubmitting=!1;return}let t=this.musicTags?.value?this.musicTags.value.split(",").map(m=>m.trim()).filter(m=>m.length>0):[],n={title:this.title?.value,type:this.type?.value,description:this.description?.value||"",releaseDate:new Date(this.releaseDate?.value),version:this.version?.value,artistID:a.id,musicTags:t,trackIds:[]};console.log("Creating release with data:",n),this.releaseService.createRelease(n).subscribe({next:m=>{console.log("Release created successfully:",m),this.router.navigate(["/home"])},error:m=>{console.error("Error creating release:",m),this.errorMessage=m.error?.message||"Failed to create release. Please try again.",this.isSubmitting=!1}})}markFormGroupTouched(){Object.keys(this.releaseForm.controls).forEach(a=>{this.releaseForm.get(a)?.markAsTouched()})}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=_({type:r,selectors:[["app-new"]],decls:61,vars:10,consts:[[1,"container"],[3,"ngSubmit","formGroup"],[1,"form-group"],["for","title"],["type","text","id","title","formControlName","title","required","","placeholder","Release Title",1,"text-input"],["class","error-message",4,"ngIf"],["for","type"],["name","type","id","type","formControlName","type","required","",1,"text-input"],["value",""],["value","single"],["value","album"],["value","ep"],["for","description"],["placeholder","Description","id","description","formControlName","description","rows","3",1,"text-input"],["for","releaseDate"],["placeholder","Release Date","type","date","id","releaseDate","formControlName","releaseDate","required","",1,"text-input"],["for","version"],["type","text","id","version","formControlName","version","placeholder","e.g., 1.0, Deluxe Edition","required","",1,"text-input"],["for","coverImage"],["type","file","id","coverImage","accept","image/*","required","",1,"file-input",3,"change"],["for","audioFiles"],["type","file","id","audioFiles","accept","audio/*","multiple","",1,"file-input",3,"change"],[1,"form-text"],["for","musicTags"],["type","text","id","musicTags","formControlName","musicTags","placeholder","Music Tags (comma separated)",1,"text-input"],[1,"form-actions"],["type","submit",1,"btn","btn-primary",3,"disabled"],[4,"ngIf"],["type","button",1,"btn","btn-secondary",3,"click"],["class","alert alert-danger mt-3",4,"ngIf"],[1,"error-message"],[1,"alert","alert-danger","mt-3"]],template:function(t,n){t&1&&(i(0,"div",0)(1,"h2"),l(2,"New Release"),e(),u(3,"br"),i(4,"form",1),f("ngSubmit",function(){return n.onSubmit()}),i(5,"div",2)(6,"label",3),l(7,"Title"),e(),u(8,"input",4),p(9,O,2,1,"div",5),e(),i(10,"div",2)(11,"label",6),l(12,"Release Type"),e(),i(13,"select",7)(14,"option",8),l(15,"Select type..."),e(),i(16,"option",9),l(17,"Single"),e(),i(18,"option",10),l(19,"Album"),e(),i(20,"option",11),l(21,"EP"),e()(),p(22,j,2,1,"div",5),e(),i(23,"div",2)(24,"label",12),l(25,"Description"),e(),u(26,"textarea",13),e(),i(27,"div",2)(28,"label",14),l(29,"Release Date"),e(),u(30,"input",15),p(31,B,2,1,"div",5),e(),i(32,"div",2)(33,"label",16),l(34,"Version"),e(),u(35,"input",17),p(36,Y,2,1,"div",5),e(),i(37,"div",2)(38,"label",18),l(39,"Cover Image"),e(),i(40,"input",19),f("change",function(v){return n.onFileChange(v)}),e(),p(41,z,2,0,"div",5),e(),i(42,"div",2)(43,"label",20),l(44,"Audio Files"),e(),i(45,"input",21),f("change",function(v){return n.onAudioFileChange(v)}),e(),i(46,"small",22),l(47,"Select multiple audio files for your release"),e()(),i(48,"div",2)(49,"label",23),l(50,"Music Tags"),e(),u(51,"input",24),i(52,"small",22),l(53,"e.g., rock, pop, electronic"),e()(),i(54,"div",25)(55,"button",26),p(56,H,2,0,"span",27)(57,J,2,0,"span",27),e(),i(58,"button",28),f("click",function(){return n.cancel()}),l(59,"Cancel"),e()()(),p(60,K,2,1,"div",29),e()),t&2&&(o(4),s("formGroup",n.releaseForm),o(5),s("ngIf",(n.title==null?null:n.title.invalid)&&(n.title==null?null:n.title.touched)),o(13),s("ngIf",(n.type==null?null:n.type.invalid)&&(n.type==null?null:n.type.touched)),o(9),s("ngIf",(n.releaseDate==null?null:n.releaseDate.invalid)&&(n.releaseDate==null?null:n.releaseDate.touched)),o(5),s("ngIf",(n.version==null?null:n.version.invalid)&&(n.version==null?null:n.version.touched)),o(5),s("ngIf",!n.selectedCoverImage),o(14),s("disabled",n.releaseForm.invalid||n.isSubmitting),o(),s("ngIf",n.isSubmitting),o(),s("ngIf",!n.isSubmitting),o(3),s("ngIf",n.errorMessage))},dependencies:[C,S,k,T,q,R,x,w,N,F,A,I,D],encapsulation:2})};export{G as NewComponent};

import{i as u}from"./chunk-EQG5L6AV.js";import{I as r,L as a,R as o,i}from"./chunk-VEP5YUMW.js";var l=class s{http=o(u);apiUrl="http://localhost:5051/api/auth";currentUserSubject=new i(null);isAuthenticatedSubject=new i(!1);currentUser$=this.currentUserSubject.asObservable();isAuthenticated$=this.isAuthenticatedSubject.asObservable();constructor(){this.loadUserFromStorage()}register(t){return this.http.post(`${this.apiUrl}/register`,t).pipe(r(e=>this.setSession(e)))}login(t){return this.http.post(`${this.apiUrl}/login`,t).pipe(r(e=>this.setSession(e)))}logout(){localStorage.removeItem("auth_token"),localStorage.removeItem("current_user"),this.currentUserSubject.next(null),this.isAuthenticatedSubject.next(!1)}getToken(){return localStorage.getItem("auth_token")}getCurrentUser(){return this.currentUserSubject.value}isAuthenticated(){return this.isAuthenticatedSubject.value}setSession(t){localStorage.setItem("auth_token",t.token),localStorage.setItem("current_user",JSON.stringify(t.user)),this.currentUserSubject.next(t.user),this.isAuthenticatedSubject.next(!0)}loadUserFromStorage(){let t=localStorage.getItem("auth_token"),e=localStorage.getItem("current_user");if(t&&e)try{let n=JSON.parse(e);this.currentUserSubject.next(n),this.isAuthenticatedSubject.next(!0)}catch{this.logout()}}updateAccount(t){return this.http.put(`${this.apiUrl}/update/${t}`,{username:t})}updateProfile(t){return this.http.put("http://localhost:5051/api/profile",t).pipe(r(e=>{localStorage.setItem("current_user",JSON.stringify(e)),this.currentUserSubject.next(e)}))}getUserProfile(t){return this.http.get(`http://localhost:5051/api/profile/${t}`)}static \u0275fac=function(e){return new(e||s)};static \u0275prov=a({token:s,factory:s.\u0275fac,providedIn:"root"})};export{l as a};
